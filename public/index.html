<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Student Management System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="loadStudents()">
  <h1>Student Management System</h1>
  <a class="button" href="add.html">Add Student</a>

  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Class</th><th>Actions</th></tr>
    </thead>
    <tbody id="studentsTable"></tbody>
  </table>

<script>
async function loadStudents(){
  const res = await fetch('/students');
  if(!res.ok){
    document.getElementById('studentsTable').innerHTML = '<tr><td colspan="4">Unable to load students</td></tr>';
    return;
  }
  const students = await res.json();
  const table = document.getElementById('studentsTable');
  table.innerHTML = '';
  if(students.length === 0) {
    table.innerHTML = '<tr><td colspan="4">No students found</td></tr>';
    return;
  }
  students.forEach(s => {
    table.innerHTML += `
      <tr>
        <td>${s.id}</td>
        <td>${s.name}</td>
        <td>${s.class}</td>
        <td>
          <a class="small" href="edit.html?id=${encodeURIComponent(s.id)}">Edit</a>
          <button onclick="deleteStudent('${s.id}')">Delete</button>
        </td>
      </tr>
    `;
  });
}

async function deleteStudent(id){
  if(!confirm('Delete student with id ' + id + '?')) return;
  const res = await fetch(`/students/${id}`, { method: 'DELETE' });
  if(res.ok) loadStudents();
  else alert('Delete failed');
}
</script>
</body>
</html>
